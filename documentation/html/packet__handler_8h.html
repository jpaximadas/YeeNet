<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YeeNet: my-project/packet_handler.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">YeeNet
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_05b795659ba9e4f9a0fe8fa0ccf9ae2b.html">my-project</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">packet_handler.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Provides a reliable interface for transmitting and receiving packets.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;modem_hl.h&quot;</code><br />
<code>#include &quot;address.h&quot;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;callback_timer.h&quot;</code><br />
<code>#include &quot;packet.h&quot;</code><br />
<code>#include &quot;uart.h&quot;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;util.h&gt;</code><br />
</div>
<p><a href="packet__handler_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpacket__handler.html">packet_handler</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a83f2c1e421af1bc836ea53cc416205ab"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="packet__handler_8h.html#a83f2c1e421af1bc836ea53cc416205ab">send_mode</a> { <a class="el" href="packet__handler_8h.html#a83f2c1e421af1bc836ea53cc416205abae55e930eb9d9011b6f8a397ef83ad950">LAZY</a> =0, 
<a class="el" href="packet__handler_8h.html#a83f2c1e421af1bc836ea53cc416205aba9c9c5bc7490e9a68e4705e5fa413122f">PERSISTENT</a>
 }</td></tr>
<tr class="separator:a83f2c1e421af1bc836ea53cc416205ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae26a92a9fe08e1847e90f596f93f24bd"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="packet__handler_8h.html#ae26a92a9fe08e1847e90f596f93f24bd">handler_state</a> { <a class="el" href="packet__handler_8h.html#ae26a92a9fe08e1847e90f596f93f24bda4ade5a087dd858a01c36ce7ad8f64e36">UNLOCKED</a> =0, 
<a class="el" href="packet__handler_8h.html#ae26a92a9fe08e1847e90f596f93f24bda6b4af979c9694e48f340397ac08dfd1c">LOCKED</a>
 }</td></tr>
<tr class="separator:ae26a92a9fe08e1847e90f596f93f24bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacdc622aa02a946d7a3d67c361199733"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="packet__handler_8h.html#aacdc622aa02a946d7a3d67c361199733">packet_state</a> { <a class="el" href="packet__handler_8h.html#aacdc622aa02a946d7a3d67c361199733ac7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a> =0, 
<a class="el" href="packet__handler_8h.html#aacdc622aa02a946d7a3d67c361199733aecedb56d1405a60c6069f4a0139bdec5">FAILED</a>
 }</td></tr>
<tr class="separator:aacdc622aa02a946d7a3d67c361199733"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adfc15d325976370f40e76aded3623f66"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="packet__handler_8h.html#adfc15d325976370f40e76aded3623f66">handler_setup</a> (struct <a class="el" href="structpacket__handler.html">packet_handler</a> *this_handler, struct <a class="el" href="structmodem.html">modem</a> *_my_modem, struct <a class="el" href="structpacket__data.html">packet_data</a> *_rx_pkt, void(*_pkt_rdy_callback)(void *), void *_callback_arg, enum <a class="el" href="packet__handler_8h.html#a83f2c1e421af1bc836ea53cc416205ab">send_mode</a> _my_send_mode, uint8_t _backoffs_max)</td></tr>
<tr class="separator:adfc15d325976370f40e76aded3623f66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e36dc4e6250ee9cf77686d07490fa4c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="packet__handler_8h.html#a7e36dc4e6250ee9cf77686d07490fa4c">handler_request_transmit</a> (struct <a class="el" href="structpacket__handler.html">packet_handler</a> *this_handler, struct <a class="el" href="structpacket__data.html">packet_data</a> *pkt)</td></tr>
<tr class="separator:a7e36dc4e6250ee9cf77686d07490fa4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Provides a reliable interface for transmitting and receiving packets. </p>
<p>The packet handler layer manages a modem on a half-duplex connection. It performs a few important tasks that makes using a modem more reliable and eliminates timing considerations from the design of higher layers:</p><ul>
<li>Prevents transmission during reception of a packet</li>
<li>Detects whether a packet was successfully (method for this depends on whether the packet was ACKED/UNACKED)</li>
<li>Responds to detected failures of packet transmission in PERSISTENT modem in a way that resolves collisions (exponential backoff)</li>
<li>Prevents further tranmissions if a packet is in the process of being sent</li>
<li>Automatically sends ACKS for packets that mandate one and NACKS when reception errors nack_occur</li>
<li>Completes tranmissions of a packet in a finite amount of time while providing indication whether packet tranmission was successful </li>
</ul>
</div><h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ae26a92a9fe08e1847e90f596f93f24bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae26a92a9fe08e1847e90f596f93f24bd">&#9670;&nbsp;</a></span>handler_state</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="packet__handler_8h.html#ae26a92a9fe08e1847e90f596f93f24bd">handler_state</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enum for indicating handler TX state. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ae26a92a9fe08e1847e90f596f93f24bda4ade5a087dd858a01c36ce7ad8f64e36"></a>UNLOCKED&#160;</td><td class="fielddoc"><p>Packet handler is ready to accept a new outgoing packet. </p>
</td></tr>
<tr><td class="fieldname"><a id="ae26a92a9fe08e1847e90f596f93f24bda6b4af979c9694e48f340397ac08dfd1c"></a>LOCKED&#160;</td><td class="fielddoc"><p>Packet handler is trying to transmit a packet and cannot accept a new outgoing packet. </p>
</td></tr>
</table>

</div>
</div>
<a id="aacdc622aa02a946d7a3d67c361199733"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacdc622aa02a946d7a3d67c361199733">&#9670;&nbsp;</a></span>packet_state</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="packet__handler_8h.html#aacdc622aa02a946d7a3d67c361199733">packet_state</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enum for expressing the status of the last transmitted packet. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="aacdc622aa02a946d7a3d67c361199733ac7f69f7c9e5aea9b8f54cf02870e2bf8"></a>SUCCESS&#160;</td><td class="fielddoc"><p>The handler concludes that the receiver got the last packet. </p>
</td></tr>
<tr><td class="fieldname"><a id="aacdc622aa02a946d7a3d67c361199733aecedb56d1405a60c6069f4a0139bdec5"></a>FAILED&#160;</td><td class="fielddoc"><p>The handler concludes that the receiver did not get the last packet. </p>
</td></tr>
</table>

</div>
</div>
<a id="a83f2c1e421af1bc836ea53cc416205ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83f2c1e421af1bc836ea53cc416205ab">&#9670;&nbsp;</a></span>send_mode</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="packet__handler_8h.html#a83f2c1e421af1bc836ea53cc416205ab">send_mode</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enum for indicating how a packet handler will deal with a reception failure on a destination node. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a83f2c1e421af1bc836ea53cc416205abae55e930eb9d9011b6f8a397ef83ad950"></a>LAZY&#160;</td><td class="fielddoc"><p>Packet handler will not attempt to retransmit after a detected reception failure at the destination.</p>
<p>PACKET_UNACKED: Reception of a NACK from the destination results in FAILED packet handler_state. Absence of a NACK results in SUCCESS packet handler state</p>
<p>PACKET_ACKED: NACKS are ignored since they are sometimes emitted when LoRa modems parse noise (mostly in SF6). ACK from destination node results in SUCCESS packet handler state. Absence of am ack results in FAILED packet handler state. </p>
</td></tr>
<tr><td class="fieldname"><a id="a83f2c1e421af1bc836ea53cc416205aba9c9c5bc7490e9a68e4705e5fa413122f"></a>PERSISTENT&#160;</td><td class="fielddoc"><p>Packet handler will attempt to retransmit until reception success or number of retransmissions equals <a class="el" href="structpacket__handler.html">packet_handler</a> member "backoffs_max"</p>
<p>PACKET_UNACKED: Reception of a NACK from the destination results in retransmission of packet or failure when backoffs_max is reached. Absence of a NACK results in SUCCESS packet handler state</p>
<p>PACKET_ACKED: NACKS are ignored since they are sometimes emitted when LoRa modems parse noise (mostly in SF6). ACK from destination node results in SUCCESS packet handler state. Absence of an ack results in successive, delayed retransmissions (exponential backoff). </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a7e36dc4e6250ee9cf77686d07490fa4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e36dc4e6250ee9cf77686d07490fa4c">&#9670;&nbsp;</a></span>handler_request_transmit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool handler_request_transmit </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpacket__handler.html">packet_handler</a> *&#160;</td>
          <td class="paramname"><em>this_handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpacket__data.html">packet_data</a> *&#160;</td>
          <td class="paramname"><em>pkt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Attempt to transmit a packet.</p>
<p>Packet handler will check two things before transmitting:</p><ul>
<li>Whether or not the handler is LOCKED</li>
<li>Whether or not the modem is busy</li>
</ul>
<p>If both checks pass, the packet handler is reset for a new packet, the packet is transmitted, and true is returned If either check fails, false is returned. packet_handler-&gt;my_state can be polled to avoid performing a function call however even if the handler state is UNLOCKED this does not preclude the possibility that the modem will be busy.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">this_handler</td><td>pointer to handler struct </td></tr>
    <tr><td class="paramname">pkt</td><td>pointer to packet ot be transmitted </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>whether or not the packet handler is starting the transmission </dd></dl>

</div>
</div>
<a id="adfc15d325976370f40e76aded3623f66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfc15d325976370f40e76aded3623f66">&#9670;&nbsp;</a></span>handler_setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handler_setup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpacket__handler.html">packet_handler</a> *&#160;</td>
          <td class="paramname"><em>this_handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmodem.html">modem</a> *&#160;</td>
          <td class="paramname"><em>_my_modem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpacket__data.html">packet_data</a> *&#160;</td>
          <td class="paramname"><em>_rx_pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(void *)&#160;</td>
          <td class="paramname"><em>_pkt_rdy_callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>_callback_arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="packet__handler_8h.html#a83f2c1e421af1bc836ea53cc416205ab">send_mode</a>&#160;</td>
          <td class="paramname"><em>_my_send_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>_backoffs_max</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set up a packet handler.</p>
<p>Preconditions:</p><ul>
<li>modem is set up</li>
<li>address has been determined</li>
<li>modem RNG has been seeded</li>
</ul>
<p>Postconditions:</p><ul>
<li>packet handler is ready to use</li>
<li>modem is listening</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">this_handler</td><td>pointer to handler struct to be set up </td></tr>
    <tr><td class="paramname">my_modem</td><td>modem to be used by the handler </td></tr>
    <tr><td class="paramname">_rx_pkt</td><td>location for incoming packets to be written </td></tr>
    <tr><td class="paramname">_pkt_rdy_callback</td><td>function pointer to be dereferenced after an incoming packet is written to _rx_packet </td></tr>
    <tr><td class="paramname">_callback_arg</td><td>argument for the pkt_rdy function </td></tr>
    <tr><td class="paramname">_my_send_mode</td><td>send mode of the packet handler </td></tr>
    <tr><td class="paramname">_backoffs_max</td><td>maximum number of backoffs before failure is reported in PERSISTENT mode </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
